<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Web缓存测试 | cj0x39e</title>
    <meta name="generator" content="VuePress 1.8.2">
    <script src="https://www.googletagmanager.com/gtag/js?id=G-1PWBM2M60V" async="true"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-1PWBM2M60V');
      </script>
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.387d7566.css" as="style"><link rel="preload" href="/assets/js/app.19b65cf0.js" as="script"><link rel="preload" href="/assets/js/5.4d3b5e53.js" as="script"><link rel="preload" href="/assets/js/13.f3a37fca.js" as="script"><link rel="prefetch" href="/assets/js/10.e7b08e66.js"><link rel="prefetch" href="/assets/js/11.a3557a6f.js"><link rel="prefetch" href="/assets/js/12.c8813de3.js"><link rel="prefetch" href="/assets/js/14.563b17b5.js"><link rel="prefetch" href="/assets/js/15.1f55af88.js"><link rel="prefetch" href="/assets/js/16.b8240ea5.js"><link rel="prefetch" href="/assets/js/17.74a7cce4.js"><link rel="prefetch" href="/assets/js/18.c619dcba.js"><link rel="prefetch" href="/assets/js/2.3da3fbd1.js"><link rel="prefetch" href="/assets/js/3.7609a0b5.js"><link rel="prefetch" href="/assets/js/4.cee37886.js"><link rel="prefetch" href="/assets/js/6.e9fb628d.js"><link rel="prefetch" href="/assets/js/7.4683c2f5.js"><link rel="prefetch" href="/assets/js/8.7613bb7f.js"><link rel="prefetch" href="/assets/js/9.e3021c92.js">
    <link rel="stylesheet" href="/assets/css/0.styles.387d7566.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container vuepress-theme-simple"><header class="header"><a href="/" title="" class="site-name router-link-active">
      cj0x39e
      
    </a> <div style="clear: both"></div> <!----></header> <section class="post-view"><div class="post-head"><h1 class="post-title">
      Web缓存测试
    </h1></div> <div class="post-sub-head"><time datetime="1/22/2017, 12:00:00 AM" title="1/22/2017, 12:00:00 AM" pubdate="pubdate" class="post-date">
  4 years ago
</time></div> <div class="content__default"><h2 id="缓存测试"><a href="#缓存测试" class="header-anchor">#</a> 缓存测试</h2> <blockquote><p>测试环境</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>window10
Chrome 55.0.2883.87
nginx 1.9.5
</code></pre></div><p>测试文件有两个，分别是 index.html 和 demo.html， 其中 demo.html 是通过 index.html 中的 <code>a</code> 标签过去的，因为直接刷新浏览器，会导致浏览器产生 <code>Cache-Control max-age=0</code> 的效果。</p> <h3 id="测试-1"><a href="#测试-1" class="header-anchor">#</a> 测试 1</h3> <blockquote><p>不配置任何缓存头</p></blockquote> <ol><li>修改 demo.html ，保存， 并等待一段时间加载， 返回 200；
响应头：</li></ol> <div class="language- extra-class"><pre class="language-text"><code>Date:Sun, 22 Jan 2017 06:08:53 GMT
ETag:&quot;58844c11-c1&quot;
Last-Modified:Sun, 22 Jan 2017 06:07:13 GMT
</code></pre></div><ol start="2"><li>快速按浏览器返回到 index.html，,通过链接再次打开 demo.html， 返回 200， 且显示 (from disk cache);
响应头：</li></ol> <div class="language- extra-class"><pre class="language-text"><code>Date:Sun, 22 Jan 2017 06:08:53 GMT
ETag:&quot;58844c11-c1&quot;
Last-Modified:Sun, 22 Jan 2017 06:07:13 GMT
</code></pre></div><ol start="3"><li>经过几次重复步骤 2，在第 5 次加载时，返回 304，,说明和服务器比对了 ETag 或者 Last-Modified；
响应头：</li></ol> <div class="language- extra-class"><pre class="language-text"><code>Date:Sun, 22 Jan 2017 06:09:03 GMT
ETag:&quot;58844c11-c1&quot;
Last-Modified:Sun, 22 Jan 2017 06:07:13 GMT
</code></pre></div><p>根据默认的过期时间计算方法 <code>当前时间 + (Date - Last-Modified) * 10%</code> 可以得到第一次加载后默认缓存时间为 10s ，所以在 9:03 前都是从本地缓存加载，从第 2 步没有变化的响应头可以看出是没有请求服务器的，而第 3 步，缓存时间刚刚过期，便携带 If-Modified-Since、If-None-Matc 去询问服务器是否需要重新拉取资源。说明在不设置缓存时间的情况下，浏览器也是缓存资源，且缓存时间就是前面提到的公式计算出的结果，等同于 &quot;Cache-Control max-age=(当前时间 + (Date - Last-Modified) * 10%)&quot;。</p> <h3 id="测试-2"><a href="#测试-2" class="header-anchor">#</a> 测试 2</h3> <blockquote><p>添加 <code>Cache-Control no-cache;</code> 响应头</p></blockquote> <p>与测试 1 表现不同，第 1 次请求为 200，之后都为 304，说明每次请求都会询问服务器，但是这不是说每次都从服务器拉取资源，只是确认这个资源还能不能用，有没有改动，没有改(304)就直接从本地缓存加载，有改动(200)就从服务器拉取了。所以添加 <code>Cache-Control no-cache;</code> 等同于加了一条 &quot;Cache-Control max-age=0&quot;。</p> <h3 id="测试-3"><a href="#测试-3" class="header-anchor">#</a> 测试 3</h3> <blockquote><p>添加 <code>Cache-Control private;</code> 响应头</p></blockquote> <p>表现与测试 1 相同；</p> <blockquote><p>添加 <code>Cache-Control public;</code> 响应头</p></blockquote> <p>表现与测试 1 相同；
因为 private 和 public 的作用在于告诉什么样的客户端能够存储资源，所以没什么影响也不奇怪。</p> <h3 id="测试-4"><a href="#测试-4" class="header-anchor">#</a> 测试 4</h3> <blockquote><p>添加 <code>Cache-Control no-store;</code> 响应头</p></blockquote> <p>这才是真正让浏览器每次都从服务器拉取的响应头，每次返回都是 200 ok，而且都是货真价实的从服务器拉取的资源。</p> <h2 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h2> <p>所以验证了下面这些定义：</p> <blockquote><p>no-cache 表示必须先与服务器确认返回的响应是否被更改
no-store 直接禁止浏览器和所有中继缓存存储返回的任何版本的响应</p></blockquote> <p>以及清楚了在不设置缓存时间的情况下，浏览器的缓存策略。</p> <p>参考资料:</p> <ol><li><a href="https://zhuanlan.zhihu.com/p/24467558" target="_blank" rel="noopener noreferrer">彻底弄懂 Http 缓存机制 - 基于缓存策略三要素分解法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching?hl=zh-cn" target="_blank" rel="noopener noreferrer">HTTP 缓存<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol></div> <div></div></section> <footer class="footer"><p class="text">© 2021 cj0x39e</p></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.19b65cf0.js" defer></script><script src="/assets/js/5.4d3b5e53.js" defer></script><script src="/assets/js/13.f3a37fca.js" defer></script>
  </body>
</html>
